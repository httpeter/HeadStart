<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"      
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:pe="http://primefaces.org/ui/extensions" 
      xmlns:p="http://primefaces.org/ui">

    <h:head>               
        <ui:include src="included/head.xhtml"/>
        <title>#{labels.appTitle} - #{labels.organizationName}</title>
    </h:head>

    <h:body styleClass="placesPage">



        <h:form id="mainForm">


            <!--MAIN MENU-->
            <ui:include src="included/menu.xhtml"/>            

            <!--DIALOGS-->
            <ui:include src="included/tripEditDLG.xhtml"/>
            <ui:include src="included/placeEditDLG.xhtml"/>
            <ui:include src="included/addPlaceDLG.xhtml"/>                
            <ui:include src="included/addTripDLG.xhtml"/>



            <p:panel style="min-width: 360px;max-width: 100%;"
                     header="Trip: #{placesController.selectedTrip.name}">



                <!--Trip overview-->
                <p:panelGrid columns="2" 
                             layout="grid">


                    <h:outputText value="Selected" styleClass="headerText"/>                    
                    <p:selectOneMenu value="#{placesController.selectedTripID}" 
                                     style="width:100%">
                        <f:selectItem itemLabel="select..." 
                                      rendered="#{placesController.selectedTripID==0}"/>
                        <f:selectItems value="#{placesController.trips}" 
                                       var="trip" 
                                       itemValue="#{trip.id}" 
                                       itemLabel="#{trip.name}"/>
                        <p:ajax update="@form" 
                                listener="#{placesController.loadPlaces()}"/>                                        
                    </p:selectOneMenu> 


                    <h:outputText/>    
                    <p:imageSwitch effect="shuffle" style="height:150px">
                        <ui:repeat value="#{placesController.gallery}" var="image">
                            <p:graphicImage url="#{image}" height="150"/>
                        </ui:repeat>
                    </p:imageSwitch>


                    <h:outputText value="Description" 
                                  rendered="#{placesController.selectedTripID!=0}"
                                  styleClass="headerText"/>
                    <h:outputText value="#{placesController.selectedTrip.description}" 
                                  rendered="#{placesController.selectedTripID!=0}"/>

                    <h:outputText value="Duration"
                                  rendered="#{placesController.selectedTripID!=0}"
                                  styleClass="headerText"/>
                    <h:outputText value="#{placesController.selectedTripDuration} days" 
                                  rendered="#{placesController.selectedTripID!=0}"/>

                    <h:outputText value="Total price" 
                                  rendered="#{placesController.selectedTripID!=0}"
                                  styleClass="headerText"/>
                    <h:outputText value="€ #{placesController.totalPrice},-"
                                  rendered="#{placesController.selectedTripID!=0}"/>

                    <h:outputText value="Still to pay" 
                                  rendered="#{placesController.selectedTripID!=0}"
                                  styleClass="headerText"/>
                    <h:outputText value="€ #{placesController.stillToPay},-"
                                  rendered="#{placesController.selectedTripID!=0}"
                                  style="color:red; font-weight: bold"/>

                    <h:outputText value="Notes" 
                                  rendered="#{placesController.selectedTripID!=0}"
                                  styleClass="headerText"/>
                    <p:inputTextarea value="#{placesController.selectedTrip.notes}"                                         
                                     style="width:100%; border: none;"
                                     disabled="true" 
                                     rendered="#{placesController.selectedTripID!=0}"/>   


                    <h:outputText/> 
                    <h:panelGrid columns="1">
                        <p:commandButton icon="fa fa-plus"
                                         oncomplete="PF('addTripDLG').show();"
                                         value="Add trip"/>                            

                        <p:commandButton icon="fa fa-gear"                                                  
                                         onclick="PF('tripEditDLG').show();" 
                                         rendered="#{placesController.selectedTripID!=0}"
                                         value="Edit trip">
                            <pe:badge content="#{placesController.places.size()}"/>
                        </p:commandButton>

                    </h:panelGrid>                                                           

                </p:panelGrid>                         









                <br/>   








                <!--Timeline-->
                <p:outputPanel rendered="#{placesController.selectedTrip.id!=0}">

                    <p:timeline id="timeline" 
                                value="#{placesController.timelineModel}"
                                var="place">

                        <h:outputText value="#{place.name}" style="font-weight: bold"/>
                        <br/>
                        <h:outputText value="#{place.country}"/>
                        <br/>
                        <h:outputText value="#{place.departuredate.date - place.arrivaldate.date} days"/>
                        <br/>
                        <h:panelGrid columns="2">
                            <h:outputText value="Booked"/>
                            <p:selectBooleanCheckbox value="#{place.booked}" disabled="true"/>                                                
                            <h:outputText value="Payed"/>
                            <p:selectBooleanCheckbox value="#{place.payed}" disabled="true"/>                        
                        </h:panelGrid>

                        <p:ajax event="select" 
                                listener="#{placesController.selectTimeline}"
                                update="@form"/>

                    </p:timeline>

                </p:outputPanel>






                <br/>






                <p:outputPanel rendered="#{placesController.selectedTrip.id!=0}">
                    <!--Map-->
                    <p:panelGrid id="map"
                                 layout="grid" 
                                 columns="1"
                                 rendered="#{placesController.selectedTripID!=0}"> 



                        <p:gmap id="gmap" 
                                widgetVar="gmap" 
                                center="46.1848764, 7.8171154" 
                                zoom="4" 
                                type="map" 
                                style="width: auto;height:400px"
                                model="#{placesController.mapModel}">                             
                            <p:ajax event="pointSelect" 
                                    listener="#{placesController.mapSelect}" 
                                    update="@form" />
                        </p:gmap>


                        <p:panelGrid layout="grid"
                                     columns="2" >
                            <h:outputText/>

                            <p:commandButton value="Add place" 
                                             icon="fa fa-plus"
                                             oncomplete="PF('addPlaceDLG').show();"                                              
                                             action="#{placesController.makeNewPlace()}"/>
                        </p:panelGrid>

                    </p:panelGrid>

                </p:outputPanel>






            </p:panel>



        </h:form>



    </h:body>

</html>